# ---------------------------- Events Block ----------------------------
# Defines global Nginx event settings
events {}

# ---------------------------- HTTP Block ----------------------------
# Configures HTTP server behavior
http {

    # ---------------------------- Server Block ----------------------------
    # Defines server listening on port 80
    server {
        listen 80;

        # ---------------------------- Frontend Serving ----------------------------
        # Serve React frontend from /usr/share/nginx/html with fallback to index.html
        location / {
            root /usr/share/nginx/html;  # Directory where built frontend resides
            index index.html;             # Default file to serve
            try_files $uri /index.html;  # SPA fallback
        }

        # ---------------------------- Backend Proxy ----------------------------
        # Proxy API requests starting with /api to FastAPI backend on port 8000
        location /api {
            proxy_pass http://backend:8000;           # Route API requests to backend container
            proxy_set_header Host $host;              # Preserve original Host header
            proxy_set_header X-Real-IP $remote_addr;  # Pass client IP
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # Forward chain of client IPs
            proxy_set_header X-Forwarded-Proto $scheme; # Forward protocol (http/https)
        }
    }
}
